# Cursor Rules for Tech4HSE Project

## Project Overview
This is a research project on privacy-preserving text sanitization using differential privacy mechanisms. The project includes implementations of PhraseDP, InferDPT, and SANTEXT+ for comparison.

## Key Directories
- `relatedworks/` - Contains PDF papers and research materials
- `overleaf-folder/` - LaTeX documents and references.bib
- `plots/` - Generated plots and visualizations
- `SanText/` - SANTEXT+ implementation
- `InferDPT/` - InferDPT implementation

## Available Tools

### 1. BibTeX Entry Fetcher
**Script**: `fetch_bibtex_final.py`
**Purpose**: Automatically fetch BibTeX entries for papers in the relatedworks folder
**Usage**: 
```bash
conda run -n priv-env python fetch_bibtex_final.py
```
**Features**:
- Reads PDF filenames and extracts paper titles
- Searches CrossRef API for BibTeX entries
- Uses known entries for common papers (SANTEXT, PRIV-QA, Tree of Attacks)
- Automatically updates `overleaf-folder/references.bib`
- Avoids duplicate entries
**When to use**: When user requests to find BibTeX entries for papers in relatedworks folder, or when new papers are added to the project

### 2. Privacy Mechanisms Comparison
**Script**: `privacy_mechanisms_comparison.py`
**Purpose**: Compare PhraseDP, InferDPT, and SANTEXT+ mechanisms
**Usage**:
```bash
conda run -n priv-env python privacy_mechanisms_comparison.py
```
**Features**:
- Tests all three privacy mechanisms on the same questions
- Generates similarity vs epsilon plots
- Provides comprehensive comparison reports

### 3. SANTEXT+ Integration
**Script**: `santext_integration.py`
**Purpose**: SANTEXT+ mechanism implementation for QA experiments
**Usage**:
```python
from santext_integration import create_santext_mechanism
santext = create_santext_mechanism(epsilon=2.0, p=0.3)
```

### 4. Epsilon Trend Analysis
**Script**: `ten_question_epsilon_test.py`
**Purpose**: Test epsilon trends with improved 10-band candidate generation
**Usage**:
```bash
conda run -n priv-env python ten_question_epsilon_test.py
```

### 5. One Question Testing
**Script**: `one_question_equal_band_email.py`
**Purpose**: Test single question with detailed candidate analysis
**Usage**:
```bash
conda run -n priv-env python one_question_equal_band_email.py
```

## Environment Setup
- **Conda Environment**: `priv-env`
- **Key Dependencies**: sentence-transformers, scikit-learn, numpy, scipy
- **API Keys**: Configured in `.env` file (Nebius, OpenAI, etc.)

## Common Commands

### Running Experiments
```bash
# Test epsilon trends
conda run -n priv-env python ten_question_epsilon_test.py

# Test single question
conda run -n priv-env python one_question_equal_band_email.py

# Compare all mechanisms
conda run -n priv-env python privacy_mechanisms_comparison.py
```

### Managing References
```bash
# Fetch BibTeX entries for new papers
conda run -n priv-env python fetch_bibtex_final.py
```
**Note**: This tool automatically handles finding BibTeX entries for papers in the `relatedworks/` folder and updates `references.bib`. Use this when the user asks to find BibTeX entries for papers or when new papers are added to the project.

### Generating Plots
```bash
# Generate epsilon trend plots
conda run -n priv-env python plot_epsilon_trend_balanced.py

# Generate candidate distribution plots
conda run -n priv-env python one_question_equal_band_email.py
```

## File Naming Conventions
- `*_epsilon_test.py` - Epsilon trend testing scripts
- `*_comparison.py` - Mechanism comparison scripts
- `*_analysis.py` - Analysis and plotting scripts
- `*_results.json` - Experimental results
- `*_findings.md` - Analysis reports

## Key Configuration Files
- `config.yaml` - Main configuration
- `email_config.json` - Email settings for reports
- `.env` - API keys and environment variables
- `overleaf-folder/references.bib` - Bibliography

## Recent Improvements
- **10-band candidate generation** with improved diversity
- **Fixed candidate pools** for consistent epsilon testing
- **SANTEXT+ integration** for comprehensive comparison
- **Automated BibTeX fetching** for reference management
- **Balanced candidate distribution** with refill loops

## Notes
- Always use `conda run -n priv-env` for Python commands
- Check `.env` file for API configuration
- Results are automatically saved with timestamps
- Email reports are sent for major experiments

## Agent Instructions
When working on this project, the agent should:
1. **Use the BibTeX fetcher tool** (`fetch_bibtex_final.py`) whenever the user requests to find BibTeX entries for papers in the `relatedworks/` folder
2. **Automatically suggest using this tool** when new papers are added to the project
3. **Know that this tool exists** and can handle the task of finding and adding BibTeX entries to `references.bib`
4. **Use the correct command**: `conda run -n priv-env python fetch_bibtex_final.py`
